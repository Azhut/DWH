# TODO

## Изменения архитектуры:
- [ ] При загрузке файла, который уже был загружен не проставляется id. При использовании API files могут выдаваться ошибочно загруженные. Как будто в коллекции files не нужно хранить информацию об ошибке. Но при upload нужно возвращать warning о том, какие файлы не были загружены, так как были ошибки с указанием ошибки. На фронте добавить нормальный формат отображения ошибки и даты, когда это произошло
- [ ] В invalid_filter добавить статус 400 или 422 в ответ
- [ ] Автоудаление логов 
- [ ] Вывод логов на фронтенд
- [ ] Пофиксить докер файлы (добавить\удалить helthcheck)


---

## Правки после новой архитектуры

- [ ] Нужно пофиксить logs: понять почему есть сущность Logs, а в сore есть дубликаты логики 
- [ ] Проверить единообразие обращения к бд

промпт для курсора:
```
- Хочу внести финальные правки. Мне кажется @app/application/upload/data_save.py @app/application/file_delete.py  @app/application/retrieval.py  @app/data/index_manager.py  заслуживают стать отдельным агрегатом, так как они тесно связаны между собой, но разбросаны по проекту. Также встает вопрос, как происходит работа с @app/core/database.py, точно ли во всем проекте используеся один экземлпяр, или где-то обращение идет иным способом? как-то бы это пофиксить  Еще встает вопрос. Если есть @app/domain/log/models.py , то нужны ли @app/core/exceptions.py  и @app/core/logger.py . 
```

- [ ] В "Справочно" нужно обрабатывать и пустые значения. Сейчас они не сохраняются
- [ ] Подумать над тем, чтобы собирать плоские данные по индексам столбцов и строк, а не по значениям. Могут быть дубли


## Сделать в будущем

- [ ] Работа с базой данных. Проверить ее асинхронность и транзакции. Например `FlatDataService.save_flat_data` использует `bulk_write`
- [ ] Проверить корректность `regisrty.py`  При перезагрузке кода (reload=True) или в многопроцессном режиме состояние может рассинхронизироваться.
- [ ] Про то, что лежит в БД в FORM. Я создал вручную, но может стоило бы автоматически создавать точно существуюещие формы, если их нет.
- [ ] Сущность "Город". Исправить название не фронте
- [ ] В Files сохраняется файлы со статусом failed. Проверка уникальности не проходит. Может нужно добавить проверку уникальности только success файлам? А еще может если получается сохранить success файл, то удалять все ошибки которые были с таким же именем файла раньше?
- [ ] странная тема с зависимостями 
 ``` python 
get_parsing_strategy_registry(sheet_service=sheet_service)

 pipeline = build_default_pipeline(
        file_service=file_service,
        data_save_service=data_save_service, 
```
- [ ] Почему вообще в коде есть вериткальные заголвоки и горизонтальные. Заменить бы их на строки и столбцы
- [ ] странная тема с реквизитами форм. В 1ФК были отдельно реквзииты и отдельно список листов для пропуска. Протетстить всегда ли так новая форма создается
- [ ] Я протестил 1ФК, вроде бы там все корректно работает, нужно протестить переход на автоматику в 1ФК, при поиске таблицы, 
- [ ] Протестить 5ФК
- [ ] настроить сжатие в mongo, чтобы уменшить размер данных 
- [ ] в nginx убрать ограничение на размер файла
- [ ] Проверить корректно ли отображается ошибка если файл загружен с ней. Типа если у меня в парсинге ошибка, то будет ли этот домен отправлен на фронт
- [ ] индекс в монго странный, надо подумать еще 
```
> [ { v: 2, key: { _id: 1 }, name: '_id_' } ]
```
- [ ] Откуда-то берутся дубли, не смог найти почему
-  [ ] Добавить проверку на удаление форм 1ФК и 5ФК, их нельзя удалять. При удалении других форм удалять все что с ними связано